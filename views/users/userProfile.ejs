<%- include('../layouts/userHeader.ejs') -%>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="./home" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>

        <section class="pt-150 pb-150">
            <div class="container">
                <div class="row">
                    <!-- <div class="col-lg-10 m-auto"> -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                                                <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true">
                                                <i class="fi-rs-marker mr-10"></i>My Address
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Orders
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet" role="tab" aria-controls="track-orders" aria-selected="false">
                                                <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#changePassword" role="tab" aria-controls="account-detail" aria-selected="true">
                                                <i class="fi-rs-user mr-10"></i>Change Password
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <% if(locals.userData) { %>
                                            <a class="nav-link" href="/logout"><i class="fi-rs-sign-out mr-10"></i>Logout</a>
                                            <% } %>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-md-8">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                                        <div class="card" style="width: 90%;">
                                            <div class="card-header d-flex justify-content-between">
                                                <% if(locals.userData) { %>
                                                <h5 class="mb-0">Hello, <%= userData.name %></h5>
                                                  <div class="ms-auto">
                                               <button id="editProfileButton" class="btn btn-sm btn-outline-primary">Edit Profile</button>
                                                   </div>
                                            </div>
                                            <div class="profile-info">
                                                <p><i class="fas fa-envelope"></i> <%= userData.email %></p>
                                                <p><i class="fas fa-phone"></i> <%= userData.mobile %></p>
                                                <% } %>
                                            </div>
                                            
                                            
                                            <div class="card-body">
                                                <p>From your account dashboard, you can easily check & view your <a href="#">recent orders</a>, manage your <a href="#">shipping and billing addresses</a>, and <a href="#">edit your password and account details</a>.</p>
                                            </div>

                                            <!-- Edit Profile Form -->
        
                                            <form id="editProfileForm" class="p-3" style="display: none;">
                                             <div class="form-group">
                                            <label for="editName">Edit Name</label>
                                            <input type="text" class="form-control" id="editName" placeholder="Enter new name" value="<%= userData.name %>">
                                            <span id="nameError" class="error-message"></span>
                                            </div>
                                             <div class="form-group">
                                            <label for="editEmail">Edit Email</label>
                                            <input type="email" class="form-control" id="editEmail" placeholder="Enter new email" value="<%= userData.email %>">
                                            <span id="emailError" class="error-message"></span>
                                            </div>
                                            <div class="form-group">
                                            <label for="editMobile">Edit Mobile</label>
                                            <input type="text" class="form-control" id="editMobile" placeholder="Enter new mobile number" value="<%= userData.mobile %>">
                                            <span id="mobileError" class="error-message"></span>
                                            </div>
                                         <button type="submit" class="btn btn-primary mt-3">Save</button>
                                                 </form>
                                        </div>
                                    </div>
    


                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>

                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover"
                                                    style="margin: 0;">

                                                        
                                                            <% if(order && order.length> 0 ){ %>
                                                                <thead class="table-dark">
                                                            <tr>
                                                                <th style="padding: 10px;">Order Id</th>
                                                                <th style="padding: 10px;">Date</th>
                                                                <th style="padding: 10px;"> Order Status</th>
                                                                <th style="padding: 10px;">Payment Status</th>
                                                                <th style="padding: 10px;">Total</th>
                                                                <th style="padding: 10px;">View</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody id="orders-tbody">
                                                            <% order.forEach(orders=> { %>
                                                            <tr>
                                                                <td style="padding: 10px;">
                                                                    <%= orders.orderId %>
                                                                </td>
                                                                <td style="padding: 10px;">
                                                            
                                                                    <%= new Date(orders.orderDate).toLocaleString('en-IN',
                                                                     { timeZone: 'Asia/Kolkata', year: 'numeric', month: '2-digit', day: '2-digit', 
                                                                     hour: '2-digit', minute: '2-digit', second: '2-digit' }) %>
                                                                </td>


                                                                <td style="padding: 10px;">
                                                                    <% if (orders.orderStatus === 'Cancelled' && orders.paymentStatus !== 'Failed') { %>
                                                                        <span class="badge bg-danger">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } else if (orders.orderStatus === 'Order Placed') { %>
                                                                        <span class="badge bg-primary">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } else if (orders.orderStatus === 'Confirmed') { %>
                                                                        <span class="badge bg-warning">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } else if (orders.orderStatus === 'Shipped') { %>
                                                                        <span class="badge bg-info">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } else if (orders.orderStatus === 'Delivered') { %>
                                                                        <span class="badge bg-success">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } else if (orders.orderStatus === 'Returned') { %> <!-- Corrected this line -->
                                                                        <span class="badge bg-secondary">
                                                                            <%= orders.orderStatus %>
                                                                        </span>
                                                                    <% } %>
                                                                </td>

                                                                    <td style="padding: 10px;">
                                                                        <span class="badge <%= orders.paymentStatus === 'Received' ? 'bg-success text-dark' : (orders.paymentStatus === 'Failed' ? 'bg-danger text-light' : 'bg-warning text-dark') %>">
                                                                            <%= orders.paymentStatus %>
                                                                        </span>
                                                                        
                                                                        </td>



                                                                        <td style="padding: 10px;">
                                                                            <%= orders.totalAmount %>
                                                                            </td>
                                                                            <td style="padding: 10px;">

                                                                                <a href="/orderDetailPage?id=<%= orders._id %>">View Order</a>
                                                                                
                                                                                </td>
                                                                            <% })%>
                

                                                            </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    
                                    <!-- <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Orders Tracking</h5>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>To track your order, please enter your Order ID in the box below and press "Track" button. This was given to you on your receipt and in the confirmation email you should have received.</p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#" method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id" placeholder="Found in your order confirmation email" type="text" class="square">
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email" placeholder="Email you used during checkout" type="email" class="square">
                                                            </div>
                                                            <button class="submit submit-auto-width" type="submit">Track</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
     -->





                                    <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="card mb-3 mb-lg-0">
                                                    <div class="card-header">
                                                        <h5 class="mb-0">My Address</h5>
                                                    </div>
                                                    <div class="card-body">
                                                        <% if (addresses && addresses.length > 0) { %>
                                                            <% addresses.forEach((address) => { %>
                                                                <div id="address_<%= address._id %>">
                                                                    <address>
                                                                        Name: <%= address.name %><br>
                                                                        Mobile: <%= address.mobile %><br>
                                                                        House Name: <%= address.houseName %><br>
                                                                        City: <%= address.city %>,<br>
                                                                        State: <%= address.state %>.<br>
                                                                        Pincode: <%= address.pincode %>
                                                                    </address>
                                                                    <a onclick="removeAddress('<%= address._id %>')" class="btn btn-danger">
                                                                        <i class="fa-solid fa-trash fa-xl"></i> Delete
                                                                    </a>
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                    <a href="/loadEditAddress?id=<%= address._id %>" class="btn btn-primary">
                                                                        <i class="fa-solid fa-pen"></i> Edit
                                                                    </a>
                                                                    <hr>
                                                                </div>
                                                            <% }); %>
                                                        <% } else { %>
                                                            <p>No address found.</p>
                                                        <% } %>
                                                        <a href="#" class="btn btn-primary btn-lg" id="toggleAddressForm">Add Address</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    
    
                                        <div class="col-lg-12" id="addressFormContainer" style="display: none;">
                                            <div class="card mb-3 mb-lg-0">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Add New Address</h5>
                                                </div>
                                                <div class="card-body">
                                                    <form id="addressForm" action="/addAddress" method="post">
                                                        <div class="form-group mb-3">
                                                            <label for="inputName" class="form-label">Name</label>
                                                            <input type="text" class="form-control form-control-lg p-3" name="name" id="inputName" placeholder="Enter your full name">
                                                            <div id="nameError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="inputMobile" class="form-label">Mobile</label>
                                                            <input type="text" class="form-control form-control-lg p-3" name="mobile" id="inputMobile" placeholder="Enter your mobile number" pattern="[0-9]{10}">
                                                            <div id="mobileError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="inputHouseName" class="form-label">House Name</label>
                                                            <input type="text" class="form-control form-control-lg p-3" name="houseName" id="inputHouseName" placeholder="Enter your house name">
                                                            <div id="houseNameError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="inputCity" class="form-label">City</label>
                                                            <input type="text" class="form-control form-control-lg p-3" name="city" id="inputCity" placeholder="Enter your city">
                                                            <div id="cityError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="inputState" class="form-label">State</label>
                                                            <input type="text" class="form-control form-control-lg p-3" name="state" id="inputState" placeholder="Enter your state">
                                                            <div id="stateError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="inputZip" class="form-label">Pin Code</label>
                                                            <input type="number" class="form-control form-control-lg p-3" name="pincode" id="inputZip" placeholder="Enter your pin code">
                                                            <div id="pinCodeError" class="text-danger"></div>
                                                        </div>
                                                        <div class="form-group mt-4">
                                                            <button type="submit" class="btn btn-fill-out btn-block btn-lg font-weight-bold">Save Address</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
    
                                    <div class="tab-pane fade" id="changePassword" role="tabpanel" aria-labelledby="changePassword-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Change Password</h5>
                                            </div>

                                            <div class="card-body">
                                                <form action="/changePassword" method="POST" id="change-password-form">
                                                    <div class="row">
                                                        <div class="form-group col-md-12">
                                                            <label>Current Password <span class="required">*</span></label>
                                                            <input class="form-control" name="currentPwd" type="password" required>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>New Password <span class="required">*</span></label>
                                                            <input class="form-control" name="newPwd" type="password" required>
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Confirm Password <span class="required">*</span></label>
                                                            <input class="form-control" name="confirmPwd" type="password" required>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <button type="submit" class="btn btn-fill-out submit font-weight-bold" name="submit">Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            
                                        </div>
                                    </div>
    
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">
                                                <form method="post" name="enq">
                                                    <div class="row">
                                                        <div class="form-group col-md-12">
                                                            <label>Display Name <span class="required">*</span></label>
                                                            <input class="form-control" name="name" type="text">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Email Address <span class="required">*</span></label>
                                                            <input class="form-control" name="email" type="email">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Current Password <span class="required">*</span></label>
                                                            <input class="form-control" name="current-pwd" type="password">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>New Password <span class="required">*</span></label>
                                                            <input class="form-control" name="new-pwd" type="password">
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Confirm Password <span class="required">*</span></label>
                                                            <input class="form-control" name="confirm-pwd" type="password">
                                                        </div>
                                                        <div class="col-md-12">
                                                            <button type="submit" class="btn btn-fill-out submit font-weight-bold" name="submit">Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- tab-content -->
                            </div>
                        </div>
                    <!-- </div> -->
                </div>
            </div>

            <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Order Pagination">
                    <ul class="pagination">
                      <% for(let i = 1; i <= totalPages; i++) { %>
                        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                          <a href="#" class="page-link pagination-link" data-page="<%= i %>"><%= i %></a>
                        </li>
                      <% } %>
                    </ul>
                  </nav>

              </div>



        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const addressForm = document.getElementById("addressForm");
    
        if (addressForm) {
            addressForm.addEventListener("submit", function (event) {
                event.preventDefault(); // Prevent form submission
    
                // Clear previous error messages
                const nameError = document.getElementById("nameError");
                const mobileError = document.getElementById("mobileError");
                const houseNameError = document.getElementById("houseNameError");
                const cityError = document.getElementById("cityError");
                const stateError = document.getElementById("stateError");
                const pincodeError = document.getElementById("pincodeError");
    
                if (nameError) nameError.textContent = "";
                if (mobileError) mobileError.textContent = "";
                if (houseNameError) houseNameError.textContent = "";
                if (cityError) cityError.textContent = "";
                if (stateError) stateError.textContent = "";
                if (pincodeError) pincodeError.textContent = "";
    
                let isValid = true;
    
                // Validate Name field to disallow spaces or numbers
                const nameInput = document.getElementById("inputName"); // Corrected from "inputAddress" to "inputName"
                if (/[\s\d]/.test(nameInput.value)) {
                    if (nameError) nameError.textContent = "Name should not contain spaces or numbers.";
                    nameInput.focus();
                    isValid = false;
                }
    
                // Validate Mobile field for 10 digits
                const mobileInput = document.getElementById("inputMobile");
                if (!/^\d{10}$/.test(mobileInput.value)) {
                    if (mobileError) mobileError.textContent = "Mobile number must be exactly 10 digits.";
                    mobileInput.focus();
                    isValid = false;
                }
    
                // Validate State and City fields to disallow numbers
                const stateInput = document.getElementById("inputState");
                const cityInput = document.getElementById("inputCity");
    
                if (/\d/.test(stateInput.value) || /\d/.test(cityInput.value)) {
                    if (stateError) stateError.textContent = "State should not contain numbers.";
                    if (cityError) cityError.textContent = "City should not contain numbers.";
                    isValid = false;
                }
    
                // Validate Pin Code to ensure it's a number
                const pincodeInput = document.getElementById("inputZip");
                if (!/^\d{6}$/.test(pincodeInput.value)) {
                    if (pincodeError) pincodeError.textContent = "Pin code must be exactly 6 digits.";
                    pincodeInput.focus();
                    isValid = false;
                }
    
                if (!isValid) {
                    return; // Stop further execution if there are validation errors
                }
    
                // If all validations pass, submit the form using fetch
                const formData = new FormData(addressForm);
                const data = Object.fromEntries(formData.entries());
    
                fetch('/addAddress', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Address Saved',
                            text: 'Address saved successfully!',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            addressForm.reset(); 
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: data.message || 'Failed to save the address.'
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'An error occurred while saving the address.'
                    });
                    console.error("Error:", error);
                });
            });
        }
    
        const addressFormContainer = document.getElementById("addressFormContainer");
        const toggleAddressForm = document.getElementById("toggleAddressForm");
    
        toggleAddressForm.addEventListener("click", function (event) {
            event.preventDefault();
            if (addressFormContainer.style.display === "none") {
                addressFormContainer.style.display = "block";
                localStorage.setItem("isAddressFormShown", "true");
            } else {
                addressFormContainer.style.display = "none";
                localStorage.removeItem("isAddressFormShown");
            }
        });
    });

   </script>
        
    <script>
        function removeAddress(addressId) {
    Swal.fire({
        title: 'Are you sure?',
        text: 'You will not be able to recover this address!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch('/removeAddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ addressId })
            })
            .then(response => {
                if (response.ok) {
                    // Remove the address from the DOM
                    const addressElement = document.getElementById('address_' + addressId);
                    addressElement.parentNode.removeChild(addressElement);
                    Swal.fire(
                        'Deleted!',
                        'Your address has been deleted.',
                        'success'
                    );
                } else {
                    Swal.fire(
                        'Error!',
                        'Failed to remove address.',
                        'error'
                    );
                }
            })
            .catch(error => {
                Swal.fire(
                    'Error!',
                    'Error occurred while removing address.',
                    'error'
                );
            });
        }
    });
}
    </script>

<script>
    document.getElementById('change-password-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    console.log('Form Data:', Array.from(formData.entries()));

    try {
        const response = await fetch(this.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(formData)  // Converts FormData to URL encoded string
        });

        const result = await response.json();

        if (result.success) {
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: result.message,
            }).then(() => {
                window.location.href = '/userProfile';
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: result.message,
            });
        }
    } catch (error) {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'An error occurred. Please try again.',
        });
    }
});
</script>

<style>
    .error-message {
      color: red;
      font-size: 0.9em; 
      margin-top: 5px; 
    }
  </style>

    <!-- edit profile -->
    <script>
        document.getElementById('editProfileButton').addEventListener('click', function() {
            var form = document.getElementById('editProfileForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });
    
        document.getElementById('editProfileForm').addEventListener('submit', function(event) {
            event.preventDefault();
    
            var name = document.getElementById('editName').value.trim();
            var email = document.getElementById('editEmail').value.trim();
            var mobile = document.getElementById('editMobile').value.trim();
            document.getElementById('nameError').textContent = '';
            document.getElementById('emailError').textContent = '';
            document.getElementById('mobileError').textContent = '';

            var nameRegex = /^[A-Za-z\s]{5,}$/; 
    var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; 
    var mobileRegex = /^\d{10}$/; 

    var isValid = true;

    
    if (!nameRegex.test(name)) {
      document.getElementById('nameError').textContent = 'Name should only contain alphabets and be at least 5 characters long.';
      isValid = false; 
    }

    if (!emailRegex.test(email)) {
      document.getElementById('emailError').textContent = 'Please enter a valid email address.';
      isValid = false; 
    }

    if (!mobileRegex.test(mobile)) {
      document.getElementById('mobileError').textContent = 'Please enter a valid 10-digit mobile number.';
      isValid = false; 
    }

    if (!isValid) {
      return; 
    }

    
            fetch('/updateProfile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, mobile })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
        
                    Swal.fire({
                        title: 'Success!',
                        text: data.message,
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        document.getElementById('editProfileForm').style.display = 'none';
                        location.reload(); 
                    });
                } else {
            
                    Swal.fire({
                        title: 'Error!',
                        text: 'Error updating profile. Please try again.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            })
            .catch(error => {
                console.error('Error updating profile:', error);
            
                Swal.fire({
                    title: 'Error!',
                    text: 'An unexpected error occurred. Please try again later.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.pagination-link').forEach(link => {
    link.addEventListener('click', function (event) {
      event.preventDefault();
      
      const page = this.getAttribute('data-page');
      console.log('Clicked page:', page);
      
      fetch(`/userProfile?page=${page}`, {
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
        .then(response => response.json())
        .then(data => {
          console.log('AJAX Response:', data);

          // Ensure the table body is found and update it
          const ordersTbody = document.getElementById('orders-tbody');
          if (!ordersTbody) {
            console.error('Orders table body not found.');
            return;
          }

          let ordersHtml = '';
          data.orders.forEach(order => {
            ordersHtml += `
              <tr>
                <td style="padding: 10px;">${order.orderId}</td>
                <td style="padding: 10px;">
                  ${new Date(order.orderDate).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                </td>
                <td style="padding: 10px;">
                  <!-- Order status badges here -->
                </td>
                <td style="padding: 10px;">${order.paymentStatus}</td>
                <td style="padding: 10px;">${order.totalAmount}</td>
                <td style="padding: 10px;">
                  <a href="/orderDetailPage?id=${order._id}">View Order</a>
                </td>
              </tr>`;
          });
          ordersTbody.innerHTML = ordersHtml;
        })
        .catch(error => console.error('Error:', error));
    });
  });
});

    </script>
      
    <%- include('../layouts/userFooter.ejs') -%>


    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="assets/js/plugins/jquery.theia.sticky.js"></script>
    <!-- Template  JS -->
    <script src="assets/js/maind134.js?v=3.4"></script>
</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-frontend/page-account.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 15 Jul 2023 10:11:15 GMT -->
</html>